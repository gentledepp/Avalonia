<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewModels="using:ControlCatalog.ViewModels"
             x:Class="ControlCatalog.Pages.ComplexVirtualizationPage"
             x:DataType="viewModels:ComplexVirtualizationPageViewModel">
  <DockPanel>
    <StackPanel DockPanel.Dock="Top" Margin="8">
      <TextBlock Classes="h1" Margin="0,0,0,8">Content Virtualization Demo</TextBlock>
      <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
        This page demonstrates content-level virtualization with 4 different data types.
        Each type has a complex nested layout with different controls (TextBox, CheckBox, ItemsControl, Image).
        Toggle virtualization on/off and scroll to see the difference in performance.
      </TextBlock>
      <TextBlock TextWrapping="Wrap" FontStyle="Italic" Foreground="Gray">
        5000 heterogeneous items (Person, Task, Product, Photo)
      </TextBlock>
    </StackPanel>

    <StackPanel DockPanel.Dock="Right" Margin="8" Width="200">
      <TextBlock Classes="h3" Margin="0,0,0,8">Settings</TextBlock>
      <CheckBox IsChecked="{Binding EnableVirtualization}" Margin="0,0,0,8">
        Enable Content Virtualization
      </CheckBox>

      <Separator Margin="0,8"/>

      <TextBlock Classes="h3" Margin="0,8,0,4">Pool Statistics</TextBlock>
      <Border BorderBrush="Gray" BorderThickness="1" Padding="8" Background="#F5F5F5">
        <TextBlock x:Name="CacheStatsText"
                   TextWrapping="Wrap"
                   FontSize="11"
                   FontFamily="Consolas,Courier New,monospace"
                   Text="Scroll to populate cache..."/>
      </Border>
    </StackPanel>

    <ListBox x:Name="MainListBox"
             ItemsSource="{Binding Items}"
             Margin="8"
             ScrollViewer.HorizontalScrollBarVisibility="Disabled">

      <!-- DataTemplate for PersonItem -->
      <ListBox.DataTemplates>
        <DataTemplate DataType="viewModels:PersonItem"
                      EnableVirtualization="True"
                      MaxPoolSizePerKey="15">
          <Border BorderBrush="#2196F3" BorderThickness="2" CornerRadius="4"
                  Padding="12" Margin="4" Background="#E3F2FD">
            <StackPanel>
              <TextBlock Text="ðŸ‘¤ PERSON" FontSize="10" Foreground="#1976D2" FontWeight="Bold" Margin="0,0,0,4"/>
              <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto">
                <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="Bold" Margin="0,0,8,4"/>
                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Name}" Margin="0,0,0,4" BorderThickness="1"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Email:" FontWeight="Bold" Margin="0,0,8,4"/>
                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Email}" Margin="0,0,0,4"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Dept:" FontWeight="Bold" Margin="0,0,8,0"/>
                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Department}" FontStyle="Italic"/>
              </Grid>
            </StackPanel>
          </Border>
        </DataTemplate>

        <!-- DataTemplate for TaskItem -->
        <DataTemplate DataType="viewModels:TaskItem"
                      EnableVirtualization="True"
                      MaxPoolSizePerKey="15">
          <Border BorderBrush="#4CAF50" BorderThickness="2" CornerRadius="4"
                  Padding="12" Margin="4" Background="#E8F5E9">
            <StackPanel>
              <TextBlock Text="âœ“ TASK" FontSize="10" Foreground="#2E7D32" FontWeight="Bold" Margin="0,0,0,4"/>
              <DockPanel Margin="0,0,0,4">
                <CheckBox IsChecked="{Binding IsCompleted}" DockPanel.Dock="Left" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding Title}" FontWeight="Bold" FontSize="14" VerticalAlignment="Center"/>
              </DockPanel>
              <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Margin="0,0,0,4"/>
              <Border BorderBrush="#4CAF50" BorderThickness="1" CornerRadius="2" Padding="4" HorizontalAlignment="Left">
                <TextBlock Text="{Binding Priority, StringFormat='Priority: {0}'}" FontSize="11" FontWeight="Bold"/>
              </Border>
            </StackPanel>
          </Border>
        </DataTemplate>

        <!-- DataTemplate for ProductItem -->
        <DataTemplate DataType="viewModels:ProductItem"
                      EnableVirtualization="True"
                      MaxPoolSizePerKey="15">
          <Border BorderBrush="#FF9800" BorderThickness="2" CornerRadius="4"
                  Padding="12" Margin="4" Background="#FFF3E0">
            <StackPanel>
              <TextBlock Text="ðŸ›’ PRODUCT" FontSize="10" Foreground="#E65100" FontWeight="Bold" Margin="0,0,0,4"/>
              <DockPanel Margin="0,0,0,4">
                <TextBlock Text="{Binding ProductName}" FontWeight="Bold" FontSize="14" DockPanel.Dock="Left"/>
                <TextBlock Text="{Binding Price, StringFormat='${0:F2}'}"
                           FontWeight="Bold"
                           Foreground="#E65100"
                           HorizontalAlignment="Right"/>
              </DockPanel>
              <TextBlock Text="Tags:" FontSize="11" Margin="0,0,0,2"/>
              <ItemsControl ItemsSource="{Binding Tags}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Background="#FF9800"
                            CornerRadius="2"
                            Padding="4,2"
                            Margin="2">
                      <TextBlock Text="{Binding}" Foreground="White" FontSize="10"/>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </Border>
        </DataTemplate>

        <!-- DataTemplate for PhotoItem -->
        <DataTemplate DataType="viewModels:PhotoItem"
                      EnableVirtualization="True"
                      MaxPoolSizePerKey="15">
          <Border BorderBrush="#9C27B0" BorderThickness="2" CornerRadius="4"
                  Padding="12" Margin="4" Background="#F3E5F5">
            <Grid ColumnDefinitions="Auto,*">
              <Image Grid.Column="0"
                     Source="{Binding ImageUrl}"
                     Width="64"
                     Height="64"
                     Margin="0,0,12,0"
                     Stretch="Uniform"/>
              <StackPanel Grid.Column="1">
                <TextBlock Text="ðŸ“· PHOTO" FontSize="10" Foreground="#6A1B9A" FontWeight="Bold" Margin="0,0,0,4"/>
                <TextBlock Text="{Binding Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,4"/>
                <DockPanel>
                  <TextBlock Text="ðŸ“ " DockPanel.Dock="Left"/>
                  <TextBlock Text="{Binding Location}" FontStyle="Italic"/>
                </DockPanel>
                <TextBlock Text="{Binding Id, StringFormat='Photo ID: {0}'}"
                           FontSize="10"
                           Foreground="Gray"
                           Margin="0,4,0,0"/>
              </StackPanel>
            </Grid>
          </Border>
        </DataTemplate>
      </ListBox.DataTemplates>
    </ListBox>
  </DockPanel>
</UserControl>
